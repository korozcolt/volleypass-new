# üîç TAREAS: REVISI√ìN Y COMPLETACI√ìN BACKEND

## üìã **OBJETIVO**

Realizar una auditor√≠a completa del backend existente y completar todas las funcionalidades pendientes seg√∫n el README y documentaci√≥n del proyecto.

---

## üéØ **TAREA 1: AUDITOR√çA DEL ESTADO ACTUAL**

### **1.1 Inventario de Resources Filament Existentes**

```bash
# Verificar qu√© Resources ya est√°n implementados:
- [ ] UserResource ‚úÖ (verificar completitud)
- [ ] TeamResource ‚úÖ (verificar completitud) 
- [ ] PlayerResource ‚úÖ (verificar completitud)
- [ ] LeagueResource ‚úÖ (verificar completitud)
- [ ] ClubResource ‚úÖ (verificar completitud)
- [ ] TournamentResource ‚ùå (FALTANTE - CR√çTICO)
- [ ] MatchResource ‚ùå (FALTANTE - CR√çTICO)
- [ ] RefereeResource ‚ùå (FALTANTE - MEDIA PRIORIDAD)
- [ ] TransferResource ‚ùå (FALTANTE - MEDIA PRIORIDAD)
- [ ] PaymentResource ‚ùå (FALTANTE - MEDIA PRIORIDAD)
```

### **1.2 Auditor√≠a de Modelos y Relaciones**

```php
// Verificar que todos los modelos tengan:
- Relaciones correctas definidas
- Fillable/guarded apropiados
- Casts para fechas/json
- Soft deletes donde corresponda
- Scopes √∫tiles
- Accessors/Mutators necesarios
```

### **1.3 Verificaci√≥n de Migraciones**

```bash
# Revisar que todas las tablas est√©n creadas:
php artisan migrate:status

# Verificar integridad referencial:
- Foreign keys correctas
- √çndices optimizados  
- Campos con constraints apropiados
```

### **1.4 Auditor√≠a de Servicios Existentes**

```php
// Verificar servicios implementados:
- [ ] FederationService ‚úÖ
- [ ] PaymentValidationService ‚úÖ  
- [ ] TransferApprovalService ‚ùå
- [ ] TournamentGeneratorService ‚úÖ (IMPLEMENTADO)
- [ ] MatchLiveService ‚úÖ (IMPLEMENTADO)
- [ ] RotationTrackingService ‚úÖ (IMPLEMENTADO)
- [ ] SanctionService ‚úÖ (IMPLEMENTADO)
- [ ] CardGenerationService ‚ùå
- [ ] QrVerificationService ‚ùå
```

---

## üéØ **TAREA 2: COMPLETAR SISTEMA DE TORNEOS**

### **2.1 Crear TournamentResource (Filament)**

```php
// app/Filament/Resources/TournamentResource.php

// Funcionalidades requeridas:
- CRUD completo de torneos
- Configuraci√≥n de formato (round-robin, eliminaci√≥n, mixto)
- Asignaci√≥n de equipos/categor√≠as
- Configuraci√≥n de fechas y horarios
- Generaci√≥n autom√°tica de fixtures
- Estado del torneo (draft, active, completed)
- Configuraci√≥n de reglas espec√≠ficas
```

### **2.2 Implementar TournamentGeneratorService**

```php
// app/Services/TournamentGeneratorService.php

// M√©todos requeridos:
- generateRoundRobinFixtures(Tournament $tournament): array
- generateEliminationBracket(Tournament $tournament): array
- generateMixedFormat(Tournament $tournament): array
- calculateScheduleDates(Tournament $tournament): array
- assignVenues(Tournament $tournament): void
- validateTournamentSetup(Tournament $tournament): array
```

### **2.3 Crear Sistema de Fixtures**

```php
// Modelos relacionados:
- TournamentFixture (partidos generados)
- TournamentRound (rondas del torneo)
- TournamentGroup (grupos en round-robin)
- TournamentBracket (brackets de eliminaci√≥n)

// Funcionalidades:
- Generaci√≥n autom√°tica seg√∫n formato
- Evitar conflictos de horarios
- Distribuci√≥n equitativa de fechas
- Asignaci√≥n autom√°tica de √°rbitros (si configurado)
```

### **2.4 Implementar Sistema de Clasificaciones**

```php
// app/Services/TournamentStandingsService.php

// Funcionalidades:
- C√°lculo autom√°tico de tabla de posiciones
- Aplicaci√≥n de criterios de desempate
- Clasificaci√≥n a playoffs autom√°tica
- Generaci√≥n de estad√≠sticas por equipo
```

---

## üéØ **TAREA 3: COMPLETAR SISTEMA DE PARTIDOS**

### **3.1 Crear MatchResource (Filament)**

```php
// app/Filament/Resources/MatchResource.php

// Funcionalidades requeridas:
- CRUD de partidos
- Asignaci√≥n de √°rbitros
- Control de estado (scheduled, in_progress, finished)
- Captura de resultados
- Registro de incidencias
- Gesti√≥n de rotaciones
- Sistema de sustituciones
```

### **3.2 Implementar MatchLiveService**

```php
// app/Services/MatchLiveService.php

// M√©todos requeridos:
- startMatch(Match $match): bool
- updateScore(Match $match, int $homeScore, int $awayScore): bool
- endSet(Match $match, int $setNumber): bool
- recordSubstitution(Match $match, array $substitution): bool
- recordSanction(Match $match, array $sanction): bool
- finishMatch(Match $match): bool
```

### **3.3 Crear RotationTrackingService**

```php
// app/Services/RotationTrackingService.php

// M√©todos requeridos:
- initializeRotation(Match $match, Team $team, array $players): void
- rotateClockwise(Match $match, Team $team): array
- rotateCounterClockwise(Match $match, Team $team): array
- validateRotation(array $rotation): bool
- getCurrentServer(Match $match, Team $team): Player
- getPositionMatrix(array $rotation): array
```

### **3.4 Implementar Sistema de Sets**

```php
// Modelo MatchSet con:
- Puntajes por set
- Duraci√≥n del set
- Rotaciones por set
- Sustituciones por set
- Sanciones por set
- Estad√≠sticas por jugador
```

---

## üéØ **TAREA 4: COMPLETAR SISTEMA DE √ÅRBITROS**

### **4.1 Crear RefereeResource (Filament)**

```php
// app/Filament/Resources/RefereeResource.php

// Funcionalidades:
- CRUD de √°rbitros
- Gesti√≥n de certificaciones
- Disponibilidad y horarios
- Historial de partidos arbitrados
- Evaluaciones de desempe√±o
- Asignaci√≥n autom√°tica/manual a partidos
```

### **4.2 Implementar RefereeAssignmentService**

```php
// app/Services/RefereeAssignmentService.php

// M√©todos:
- autoAssignReferees(Tournament $tournament): array
- manualAssignReferee(Match $match, Referee $referee): bool
- checkAvailability(Referee $referee, DateTime $datetime): bool
- getOptimalAssignments(array $matches): array
- validateAssignment(Match $match, Referee $referee): array
```

### **4.3 Crear Sistema de Evaluaciones**

```php
// Modelo RefereeEvaluation:
- Evaluaci√≥n post-partido
- Criterios de evaluaci√≥n configurables
- Puntuaci√≥n promedio
- Comentarios de equipos
- Seguimiento de mejora
```

---

## üéØ **TAREA 5: COMPLETAR SISTEMA DE TRANSFERENCIAS**

### **5.1 Crear TransferResource (Filament)**

```php
// app/Filament/Resources/TransferResource.php

// Funcionalidades:
- CRUD de transferencias
- Workflow de aprobaci√≥n multi-nivel
- Validaci√≥n de per√≠odos de transferencia
- Documentaci√≥n requerida
- Estados de transferencia
- Notificaciones autom√°ticas
```

### **5.2 Implementar TransferApprovalService**

```php
// app/Services/TransferApprovalService.php

// M√©todos:
- initiateTransfer(Player $player, Team $fromTeam, Team $toTeam): Transfer
- validateTransferEligibility(Transfer $transfer): array
- processApproval(Transfer $transfer, User $approver): bool
- rejectTransfer(Transfer $transfer, string $reason): bool
- completeTransfer(Transfer $transfer): bool
- notifyStakeholders(Transfer $transfer): void
```

### **5.3 Crear Sistema de Workflow**

```php
// Estados de transferencia:
- requested (solicitada)
- pending_club_approval (pendiente club origen)
- pending_league_approval (pendiente liga)
- pending_federation_approval (pendiente federaci√≥n)
- approved (aprobada)
- rejected (rechazada)
- completed (completada)
```

---

## üéØ **TAREA 6: COMPLETAR SISTEMA DE PAGOS**

### **6.1 Crear PaymentResource (Filament)**

```php
// app/Filament/Resources/PaymentResource.php

// Funcionalidades:
- CRUD de pagos
- Carga de comprobantes
- Validaci√≥n autom√°tica/manual
- Estados de pago
- Conciliaci√≥n de cuentas
- Reportes financieros
```

### **6.2 Extender PaymentValidationService**

```php
// app/Services/PaymentValidationService.php - EXTENDER

// Agregar m√©todos:
- validatePaymentDocument(Payment $payment): array
- processAutomaticValidation(Payment $payment): bool
- generatePaymentReport(League $league, DateRange $period): array
- reconcilePayments(League $league): array
```

### **6.3 Crear Sistema de Facturaci√≥n**

```php
// Modelos relacionados:
- Invoice (facturas)
- InvoiceItem (items de factura)
- PaymentMethod (m√©todos de pago)
- PaymentSchedule (cronograma de pagos)
```

---

## üéØ **TAREA 7: COMPLETAR SISTEMA DE CARNETIZACI√ìN**

### **7.1 Crear PlayerCardResource (Filament)**

```php
// app/Filament/Resources/PlayerCardResource.php

// Funcionalidades:
- Generaci√≥n de carnets digitales
- Personalizaci√≥n por tipo de liga
- Estados de carnet (active, expired, suspended)
- Renovaci√≥n autom√°tica
- Dise√±os configurables
```

### **7.2 Implementar CardGenerationService**

```php
// app/Services/CardGenerationService.php

// M√©todos:
- generatePlayerCard(Player $player): PlayerCard
- generateQRCode(PlayerCard $card): string
- customizeCardDesign(League $league, array $design): void
- validateCardData(Player $player): array
- renewCard(PlayerCard $card): PlayerCard
```

### **7.3 Crear QrVerificationService**

```php
// app/Services/QrVerificationService.php

// M√©todos:
- verifyQRCode(string $qrCode, string $context): array
- validatePlayerEligibility(Player $player, Match $match): bool
- logVerification(PlayerCard $card, string $context): void
- getVerificationHistory(PlayerCard $card): array
```

---

## üéØ **TAREA 8: COMPLETAR SISTEMA DE SANCIONES**

### **8.1 Crear SanctionResource (Filament)**

```php
// app/Filament/Resources/SanctionResource.php

// Funcionalidades:
- CRUD de sanciones
- Tipos de sanci√≥n configurables
- Per√≠odos de suspensi√≥n
- Appeals/apelaciones
- Historial disciplinario
```

### **8.2 Implementar SanctionService**

```php
// app/Services/SanctionService.php

// M√©todos:
- issueSanction(Player $player, SanctionType $type, string $reason): Sanction
- calculateSuspensionPeriod(Sanction $sanction): DateRange
- validatePlayerEligibility(Player $player, DateTime $date): bool
- processAppeal(Sanction $sanction, string $grounds): Appeal
- getPlayerDisciplinaryRecord(Player $player): array
```

---

## üéØ **TAREA 9: DASHBOARD Y ANALYTICS**

### **9.1 Crear Dashboard Principal**

```php
// app/Filament/Pages/Dashboard.php - EXTENDER

// Widgets adicionales:
- TournamentOverviewWidget
- MatchesTodayWidget  
- RefereeAssignmentsWidget
- PaymentStatusWidget
- PlayerRegistrationsWidget
```

### **9.2 Implementar Sistema de M√©tricas**

```php
// app/Services/AnalyticsService.php

// M√©todos:
- getTournamentStatistics(Tournament $tournament): array
- getLeagueMetrics(League $league): array
- getPlayerStatistics(Player $player): array
- getRefereePerformance(Referee $referee): array
- getFinancialSummary(League $league): array
```

---

## üéØ **TAREA 10: TESTING Y CALIDAD**

### **10.1 Completar Test Suite**

```php
// Agregar tests faltantes:
- TournamentResourceTest.php
- MatchResourceTest.php  
- RefereeResourceTest.php
- TransferResourceTest.php
- PaymentResourceTest.php
- PlayerCardResourceTest.php
- SanctionResourceTest.php
```

### **10.2 Tests de Servicios**

```php
// Tests de servicios:
- TournamentGeneratorServiceTest.php
- MatchLiveServiceTest.php
- RotationTrackingServiceTest.php
- TransferApprovalServiceTest.php
- CardGenerationServiceTest.php
- QrVerificationServiceTest.php
- SanctionServiceTest.php
```

### **10.3 Tests de Integraci√≥n**

```php
// Tests end-to-end:
- CompleteTournamentFlowTest.php
- LiveMatchManagementTest.php
- TransferWorkflowTest.php
- PaymentProcessingTest.php
```

---

## üìä **M√âTRICAS DE √âXITO**

### **Funcionales:**

- [ ] Todos los Resources de Filament funcionales
- [ ] Todos los servicios implementados y testados
- [ ] Workflows completos end-to-end
- [ ] Dashboard con m√©tricas en tiempo real
- [ ] Sistema de permisos granular funcionando

### **T√©cnicas:**

- [ ] Cobertura de tests > 90%
- [ ] Performance √≥ptima (< 2s por p√°gina)
- [ ] Base de datos optimizada
- [ ] C√≥digo bien documentado
- [ ] APIs consistentes

---

## ‚è±Ô∏è **ESTIMACI√ìN DE TIEMPO**

- **Tarea 1:** 2-3 d√≠as (Auditor√≠a)
- **Tarea 2:** 5-6 d√≠as (Sistema de torneos)
- **Tarea 3:** 4-5 d√≠as (Sistema de partidos)
- **Tarea 4:** 3-4 d√≠as (Sistema de √°rbitros)
- **Tarea 5:** 3-4 d√≠as (Sistema de transferencias)
- **Tarea 6:** 3-4 d√≠as (Sistema de pagos)
- **Tarea 7:** 4-5 d√≠as (Sistema de carnetizaci√≥n)
- **Tarea 8:** 2-3 d√≠as (Sistema de sanciones)
- **Tarea 9:** 3-4 d√≠as (Dashboard y analytics)
- **Tarea 10:** 4-5 d√≠as (Testing)

**Total estimado: 33-43 d√≠as de desarrollo**
